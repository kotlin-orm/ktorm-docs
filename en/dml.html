<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Ktorm | Data Manipulation</title><meta name="keywords" content="Kotlin, ORM, SQL, DSL, sequence"><meta name="description" content=""><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="referrer" content="always"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet"><link href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="/vendors/docsearch-css@3.6.2/style.css" rel="stylesheet"><link href="/style/doc.css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180275463-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript">window.__INITIAL_STATE__={page:{title:"Data Manipulation",lang:"en",related_path:"zh-cn/dml.html",path:"en/dml.html"},data:{"navigation-en":{home:[{title:"Quick Start",link:"en/quick-start.html",color:"purple",icon:"flash",description:"Setting up Ktorm and starting up."},{title:"SQL DSL",link:"en/query.html",color:"blue",icon:"code",description:'Use the strong-typed and flexible <a href="/en/query.html">query DSL</a> after <a href="/en/schema-definition.html">defining table schemas</a>.'},{title:"Entity Sequence",link:"en/entity-sequence.html",color:"green",icon:"line-chart",description:'Obtain entities via <a href="/en/entity-sequence.html">sequence APIs</a> after <a href="/en/entities-and-column-binding.html">column bindings</a> configured.'},{title:"API Documents",link:"api-docs/index.html",target:"_blank",color:"red",icon:"paperclip",description:"API documents for Ktorm's classes and functions."}],main:[{text:"GETTING STARTED",type:"label",isCurrent:!1},{text:"Overview",type:"link",path:"/",isCurrent:!1},{text:"Quick Start",type:"link",path:"en/quick-start.html",isCurrent:!1},{text:"CONNECTION MANAGEMENT",type:"label",isCurrent:!1},{text:"Connect to Databases",type:"link",path:"en/connect-to-databases.html",isCurrent:!1},{text:"Transaction Management",type:"link",path:"en/transaction-management.html",isCurrent:!1},{text:"Spring Support",type:"link",path:"en/spring-support.html",isCurrent:!1},{text:"SQL DSL",type:"label",isCurrent:!1},{text:"Schema Definition",type:"link",path:"en/schema-definition.html",isCurrent:!1},{text:"Query",type:"link",path:"en/query.html",isCurrent:!1},{text:"Joining",type:"link",path:"en/joining.html",isCurrent:!1},{text:"Data Manipulation",type:"link",path:"en/dml.html",isCurrent:!1},{text:"Operators",type:"link",path:"en/operators.html",isCurrent:!1},{text:"Dialects & Native SQL",type:"link",path:"en/dialects-and-native-sql.html",isCurrent:!0},{text:"ENTITY API",type:"label",isCurrent:!1},{text:"Entities & Column Binding",type:"link",path:"en/entities-and-column-binding.html",isCurrent:!1},{text:"Entity Query",type:"link",path:"en/entity-finding.html",isCurrent:!1},{text:"Entity Sequence",type:"link",path:"en/entity-sequence.html",isCurrent:!1},{text:"Sequence Aggregation",type:"link",path:"en/sequence-aggregation.html",isCurrent:!1},{text:"Entity Manipulation",type:"link",path:"en/entity-dml.html",isCurrent:!1},{text:"Define Entities as Any Class",type:"link",path:"en/define-entities-as-any-kind-of-classes.html",isCurrent:!1},{text:"SUPPORT & FEEDBACK",type:"label",isCurrent:!1},{text:"API Documents",type:"support-link",path:"api-docs/index.html",target:"_blank",isCurrent:!1},{text:"Issue Feedback",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new",target:"_blank",isCurrent:!1},{text:"Sponsor the Project",type:"support-link",path:"en/sponsor.html",isCurrent:!1}]},"navigation-zh-cn":{home:[{title:"快速上手",link:"zh-cn/quick-start.html",color:"purple",icon:"flash",description:"快速配置 Ktorm 并开始使用"},{title:"SQL DSL",link:"zh-cn/query.html",color:"blue",icon:"code",description:'<a href="/zh-cn/schema-definition.html">定义表结构</a>，使用强类型的灵活的<a href="/zh-cn/query.html">查询 DSL</a>'},{title:"实体序列",link:"zh-cn/entity-sequence.html",color:"green",icon:"line-chart",description:'<a href="/zh-cn/entities-and-column-binding.html">配置列绑定</a>，使用<a href="/zh-cn/entity-sequence.html">序列 API</a> 获取实体对象'},{title:"API 文档",link:"api-docs/index.html",target:"_blank",color:"red",icon:"paperclip",description:"查看 Ktorm 中类与函数的 API 文档"}],main:[{text:"开始",type:"label"},{text:"简介",type:"link",path:"zh-cn/"},{text:"快速上手",type:"link",path:"zh-cn/quick-start.html"},{text:"连接管理",type:"label"},{text:"连接数据库",type:"link",path:"zh-cn/connect-to-databases.html"},{text:"事务管理",type:"link",path:"zh-cn/transaction-management.html"},{text:"Spring 支持",type:"link",path:"zh-cn/spring-support.html"},{text:"SQL DSL",type:"label"},{text:"定义表结构",type:"link",path:"zh-cn/schema-definition.html"},{text:"查询",type:"link",path:"zh-cn/query.html"},{text:"联表",type:"link",path:"zh-cn/joining.html"},{text:"增删改",type:"link",path:"zh-cn/dml.html"},{text:"运算符",type:"link",path:"zh-cn/operators.html"},{text:"方言与原生 SQL",type:"link",path:"zh-cn/dialects-and-native-sql.html"},{text:"实体类 API",type:"label"},{text:"实体类与列绑定",type:"link",path:"zh-cn/entities-and-column-binding.html"},{text:"实体查询",type:"link",path:"zh-cn/entity-finding.html"},{text:"实体序列",type:"link",path:"zh-cn/entity-sequence.html"},{text:"序列聚合",type:"link",path:"zh-cn/sequence-aggregation.html"},{text:"实体增删改",type:"link",path:"zh-cn/entity-dml.html"},{text:"使用任意的类作为实体类",type:"link",path:"zh-cn/define-entities-as-any-kind-of-classes.html"},{text:"支持和反馈",type:"label"},{text:"API 文档",type:"support-link",path:"api-docs/index.html",target:"_blank"},{text:"问题反馈",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new",target:"_blank"},{text:"打赏作者",type:"support-link",path:"zh-cn/sponsor.html"}]}},config:{timezone:null,root:"/",time_format:"HH:mm:ss",theme:"doc"}},window.localStorage&&"true"===window.localStorage.getItem("navigation_collapsed")&&document.getElementsByTagName("body")[0].classList.add("doc-navigation--is-collapsed")</script><div id="navigation-container"><div class="doc-navigation"><nav class="doc-navbar"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i><span class="doc-navbar__logo"><a href="/"><img src="/images/logo.png" class="doc-navbar__logo__img"><img src="/images/logo-middle.png" class="doc-navbar__logo__img-full"></a></span><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close"></i><span class="lang-switcher"><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/dml.html">简体中文</a></span></span></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search documents</span></span><span class="DocSearch-Button-Keys"></span></button></div><ul class="doc-sidebar-list"><li class="doc-sidebar-list__item doc-sidebar-list__item--label doc-sidebar-list__item--no-children"><span>GETTING STARTED</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/" target="_self"><span>Overview</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/quick-start.html" target="_self"><span>Quick Start</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label doc-sidebar-list__item--no-children"><span>CONNECTION MANAGEMENT</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/connect-to-databases.html" target="_self"><span>Connect to Databases</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/transaction-management.html" target="_self"><span>Transaction Management</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/spring-support.html" target="_self"><span>Spring Support</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label doc-sidebar-list__item--no-children"><span>SQL DSL</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/schema-definition.html" target="_self"><span>Schema Definition</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/query.html" target="_self"><span>Query</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/joining.html" target="_self"><span>Joining</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--current doc-sidebar-list__item--no-children"><a href="/en/dml.html" target="_self"><span>Data Manipulation</span></a><ul class="doc-sidebar-list__toc-list"></ul></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/operators.html" target="_self"><span>Operators</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/dialects-and-native-sql.html" target="_self"><span>Dialects &amp; Native SQL</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label doc-sidebar-list__item--no-children"><span>ENTITY API</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/entities-and-column-binding.html" target="_self"><span>Entities &amp; Column Binding</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/entity-finding.html" target="_self"><span>Entity Query</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/entity-sequence.html" target="_self"><span>Entity Sequence</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/sequence-aggregation.html" target="_self"><span>Sequence Aggregation</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/entity-dml.html" target="_self"><span>Entity Manipulation</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/define-entities-as-any-kind-of-classes.html" target="_self"><span>Define Entities as Any Class</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label doc-sidebar-list__item--no-children"><span>SUPPORT &amp; FEEDBACK</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/api-docs/index.html" target="_blank"><span>API Documents</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="https://github.com/kotlin-orm/ktorm/issues/new" target="_blank"><span>Issue Feedback</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--no-children"><a href="/en/sponsor.html" target="_self"><span>Sponsor the Project</span></a></li></ul></div></nav></div></div><div class="doc-content"><div id="lang-switcher-container" class="lang-switcher-container"><span class="lang-switcher"><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/dml.html">简体中文</a></span></span></div><div class="dc-page"><div class="dc-card"><article id="page-content" class="doc-formatting"><a class="page-link-to-github" target="_blank" href="https://github.com/kotlin-orm/ktorm-docs/edit/master/source/en/dml.md"><i class="icon fa fa-github"></i> <span class="text">Edit Page</span></a><h1 id="data-manipulation"><a class="markdownIt-Anchor" href="#data-manipulation"></a> Data Manipulation</h1><p>Ktorm not only provides SQL DSL for query and joining, but it also supports data manipulation conveniently. Let’s talk about its DML DSL now.</p><h2 id="insert"><a class="markdownIt-Anchor" href="#insert"></a> Insert</h2><p>Ktorm uses an extension function <code>insert</code> of <code>Database</code> class to support data insertion, the signature of which is given as follows:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : BaseTable&lt;*&gt;</span>&gt; Database.<span class="title">insert</span><span class="params">(table: <span class="type">T</span>, block: <span class="type">AssignmentsBuilder</span>.(<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span>: <span class="built_in">Int</span></span><br></pre></td></tr></table></figure><p>The function accepts a closure as its parameter in which we configure our insertion columns and values. After the insertion completes, an int number of affected records will be returned. Usage:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">database.insert(Employees) &#123;</span><br><span class="line">    <span class="keyword">set</span>(it.name, <span class="string">&quot;jerry&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.job, <span class="string">&quot;trainee&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.managerId, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.hireDate, LocalDate.now())</span><br><span class="line">    <span class="keyword">set</span>(it.salary, <span class="number">50</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.departmentId, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Generated SQL:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_employee (name, job, manager_id, hire_date, salary, department_id) <span class="keyword">values</span> (?, ?, ?, ?, ?, ?) </span><br></pre></td></tr></table></figure><p>Here, we use <code>set(it.name, &quot;jerry&quot;)</code> to set the name to jerry in the closure, do you know how it works?</p><p>It can be seen that the type of the closure is <code>AssignmentsBuilder.(T) -&gt; Unit</code>, which is a function that accepts a parameter <code>T</code>, the table object specified by the first parameter of <code>insert</code>, that’s why we can use <code>it</code> to access the current table and its columns in the closure. Moreover, the closure is also an extension function of <code>AssignmentsBuilder</code>, so in the scope of the closure, <code>this</code> reference is changed to an <code>AssignmentsBuilder</code> instance, that’s why we can call its member function <code>set</code> there.</p><p>Sometimes we may use auto-increment keys in our tables, we may need to obtain the auto-generated keys from databases after records are inserted. This time we can use <code>insertAndGenerateKey</code> function, the usage of which is similar to <code>insert</code>, but differently, it doesn’t return the affected record numbers anymore, but returns the auto-generated keys instead.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> id = database.insertAndGenerateKey(Employees) &#123;</span><br><span class="line">    <span class="keyword">set</span>(it.name, <span class="string">&quot;jerry&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.job, <span class="string">&quot;trainee&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.managerId, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.hireDate, LocalDate.now())</span><br><span class="line">    <span class="keyword">set</span>(it.salary, <span class="number">50</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.departmentId, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sometimes we may need to insert a large number of records in one time, and the performance of calling <code>insert</code> function in a loop may be intolerable. Ktorm provides a <code>batchInsert</code> function that can improve the performance of batch insertion, it’s implemented based on <code>executeBatch</code> of JDBC.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">database.batchInsert(Employees) &#123;</span><br><span class="line">    item &#123;</span><br><span class="line">        <span class="keyword">set</span>(it.name, <span class="string">&quot;jerry&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.job, <span class="string">&quot;trainee&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.managerId, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.hireDate, LocalDate.now())</span><br><span class="line">        <span class="keyword">set</span>(it.salary, <span class="number">50</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.departmentId, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    item &#123;</span><br><span class="line">        <span class="keyword">set</span>(it.name, <span class="string">&quot;linda&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.job, <span class="string">&quot;assistant&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.managerId, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.hireDate, LocalDate.now())</span><br><span class="line">        <span class="keyword">set</span>(it.salary, <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">set</span>(it.departmentId, <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>batchInsert</code> function also accepts a closure as its parameter, the type of which is <code>BatchInsertStatementBluilder&lt;T&gt;.() -&gt; Unit</code>, an extension function of <code>BatchInsertStatementBuilder</code>. The <code>item</code> is actually a member function in <code>BatchInsertStatementBuilder</code>, we use this function to configure every record of the batch insertion. After the batch insertion completes, an <code>IntArray</code> will be returned, that’s the affected record numbers of each sub-operation.</p><p>Sometimes, we may need to transfer data from a table to another one. Ktorm also provides an <code>insertTo</code> function, that’s an extension function of <code>Query</code> class, used to insert the query’s results into a specific table. Comparing to obtaining query results first and insert them via <code>batchInsert</code>, the <code>insertTo</code> function just execute one SQL, the performance is much better.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">database</span><br><span class="line">    .from(Departments)</span><br><span class="line">    .select(Departments.name, Departments.location)</span><br><span class="line">    .<span class="keyword">where</span> &#123; Departments.id eq <span class="number">1</span> &#125;</span><br><span class="line">    .insertTo(Departments, Departments.name, Departments.location)</span><br></pre></td></tr></table></figure><p>Generated SQL:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_department (name, location) </span><br><span class="line"><span class="keyword">select</span> t_department.name <span class="keyword">as</span> t_department_name, t_department.location <span class="keyword">as</span> t_department_location </span><br><span class="line"><span class="keyword">from</span> t_department </span><br><span class="line"><span class="keyword">where</span> t_department.id <span class="operator">=</span> ? </span><br></pre></td></tr></table></figure><h2 id="update"><a class="markdownIt-Anchor" href="#update"></a> Update</h2><p>Ktorm uses an extension function <code>update</code> of <code>Database</code> class to support data update, the signature of which is given as follows:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : BaseTable&lt;*&gt;</span>&gt; Database.<span class="title">update</span><span class="params">(table: <span class="type">T</span>, block: <span class="type">UpdateStatementBuilder</span>.(<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span>: <span class="built_in">Int</span></span><br></pre></td></tr></table></figure><p>Similar to the <code>insert</code> function, it also accepts a closure as its parameter and returns the affected record number after the update completes. The closure’s type is <code>UpdateStatementBuilder.(T) -&gt; Unit</code>, in which <code>UpdateStatementBuilder</code> is a subclass of <code>AssignmentsBuilder</code>, so we can still use <code>set(it.name, &quot;jerry&quot;)</code> to set the name to jerry. Differently, <code>UpdateStatementBuilder</code> provides an additional function <code>where</code>, that’s used to specify our update conditions. Usage:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">database.update(Employees) &#123;</span><br><span class="line">    <span class="keyword">set</span>(it.job, <span class="string">&quot;engineer&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.managerId, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">set</span>(it.salary, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">where</span> &#123;</span><br><span class="line">        it.id eq <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Generated SQL:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_employee <span class="keyword">set</span> job <span class="operator">=</span> ?, manager_id <span class="operator">=</span> ?, salary <span class="operator">=</span> ? <span class="keyword">where</span> id <span class="operator">=</span> ? </span><br></pre></td></tr></table></figure><p>It is worth mentioning that we can not only use a column value as the second argument of the <code>set</code> function, but an expression is also OK. It means that a column can be updated to a specific value or a result of any complex expressions. We can use this feature to do something special, for instance, increasing someone’s salary:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">database.update(Employees) &#123;</span><br><span class="line">    <span class="keyword">set</span>(it.salary, it.salary + <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">where</span> &#123; </span><br><span class="line">        it.id eq <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Generated SQL:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_employee <span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">+</span> ? <span class="keyword">where</span> id <span class="operator">=</span> ? </span><br></pre></td></tr></table></figure><p>Sometimes we may need to execute a large number of updates in one time, and the performance of calling <code>update</code> function in a loop may be intolerable. This time, we can use <code>batchUpdate</code> function, that can improve the performance of batch updates. Similar to <code>batchInsert</code> function, it’s also implemented based on <code>executeBatch</code> of JDBC. The operation below shows how to use <code>batchUpdate</code> to update specific departments’ location to “Hong Kong”. We can see that the usage is similar to <code>batchInsert</code>, the only difference is we need to specify the update conditions by <code>where</code> function.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">database.batchUpdate(Departments) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.2</span>) &#123;</span><br><span class="line">        item &#123;</span><br><span class="line">            <span class="keyword">set</span>(it.location, <span class="string">&quot;Hong Kong&quot;</span>)</span><br><span class="line">            <span class="keyword">where</span> &#123;</span><br><span class="line">                it.id eq i</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="delete"><a class="markdownIt-Anchor" href="#delete"></a> Delete</h2><p>Ktorm uses an extension function <code>delete</code> of <code>Database</code> class to support data deletion, the signature of which is given as follows:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : BaseTable&lt;*&gt;</span>&gt; Database.<span class="title">delete</span><span class="params">(table: <span class="type">T</span>, predicate: (<span class="type">T</span>) -&gt; <span class="type">ColumnDeclaring</span>&lt;<span class="type">Boolean</span>&gt;)</span></span>: <span class="built_in">Int</span></span><br></pre></td></tr></table></figure><p>The <code>delete</code> function accepts a closure as its parameter, in which we need to specify our conditions. After the deletion completes, the affected record number will be returned. The closure accepts a parameter of type <code>T</code>, which is actually the current table object, so we can use <code>it</code> to access the current table in the closure. The usage is very simple:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database.delete(Employees) &#123; it.id eq <span class="number">4</span> &#125;</span><br></pre></td></tr></table></figure><p>This line of code will delete the employee whose id is 4.</p><div id="support-footer-container"><div class="doc-support-footer"><div class="doc-footer-link">Prev Article: <a href="/en/joining.html">Joining</a></div><div class="doc-footer-link">Next Article: <a href="/en/operators.html">Operators</a></div>Any questions about the document? Try searching again on the left menu or <a href="https://github.com/kotlin-orm/ktorm/issues/new">raise an issue on GitHub</a></div></div></article></div></div><div class="doc-footer">&copy; 2025 KTORM.ORG. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a><br>Hosted by <a href="https://github.com/kotlin-orm/ktorm">GitHub</a> <a href="https://github.com/kotlin-orm/ktorm/stargazers"><img src="https://img.shields.io/github/stars/kotlin-orm/ktorm.svg?style=social" alt="Stars"></a></div></div><script src="/vendors/jquery@3.2.1/jquery.min.js"></script><script src="/script/doc.js"></script></body></html>