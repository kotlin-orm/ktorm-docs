<!-- build time:Wed Dec 22 2021 22:40:27 GMT+0800 (CST) --><!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Ktorm | Schema Definition</title><meta name="keywords" content="Kotlin, ORM, SQL, DSL, sequence"><meta name="description" content=""><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="referrer" content="always"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"><link href="/style/doc.css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"></head><body><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180275463-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript">window.__INITIAL_STATE__={page:{title:"Schema Definition",lang:"en",related_path:"zh-cn/schema-definition.html",path:"en/schema-definition.html"},data:{"navigation-en":{home:[{title:"Quick Start",link:"en/quick-start.html",color:"purple",icon:"flash",description:"Setting up Ktorm and starting up."},{title:"SQL DSL",link:"en/query.html",color:"blue",icon:"code",description:'Use the strong-typed and flexible <a href="/en/query.html">query DSL</a> after <a href="/en/schema-definition.html">defining table schemas</a>.'},{title:"Entity Sequence",link:"en/entity-sequence.html",color:"green",icon:"line-chart",description:'Obtain entities via <a href="/en/entity-sequence.html">sequence APIs</a> after <a href="/en/entities-and-column-binding.html">column bindings</a> configured.'},{title:"API Documents",link:"api-docs/index.html",color:"red",icon:"paperclip",description:"API documents for Ktorm's classes and functions."}],main:[{text:"Overview",type:"link",path:"",isCurrent:!1},{text:"Quick Start",type:"link",path:"en/quick-start.html",isCurrent:!1},{text:"CONNECTION MANAGEMENT",type:"label",isCurrent:!1},{text:"Connect to Databases",type:"link",path:"en/connect-to-databases.html",isCurrent:!1},{text:"Transaction Management",type:"link",path:"en/transaction-management.html",isCurrent:!1},{text:"Spring Support",type:"link",path:"en/spring-support.html",isCurrent:!1},{text:"SQL DSL",type:"label",isCurrent:!1},{text:"Schema Definition",type:"link",path:"en/schema-definition.html",isCurrent:!1},{text:"Query",type:"link",path:"en/query.html",isCurrent:!1},{text:"Joining",type:"link",path:"en/joining.html",isCurrent:!1},{text:"Data Manipulation",type:"link",path:"en/dml.html",isCurrent:!1},{text:"Operators",type:"link",path:"en/operators.html",isCurrent:!0},{text:"Dialects & Native SQL",type:"link",path:"en/dialects-and-native-sql.html",isCurrent:!1},{text:"ENTITY API",type:"label",isCurrent:!1},{text:"Entities & Column Binding",type:"link",path:"en/entities-and-column-binding.html",isCurrent:!1},{text:"Entity Query",type:"link",path:"en/entity-finding.html",isCurrent:!1},{text:"Entity Sequence",type:"link",path:"en/entity-sequence.html",isCurrent:!1},{text:"Sequence Aggregation",type:"link",path:"en/sequence-aggregation.html",isCurrent:!1},{text:"Entity Manipulation",type:"link",path:"en/entity-dml.html",isCurrent:!1},{text:"Define Entities as Any Class",type:"link",path:"en/define-entities-as-any-kind-of-classes.html",isCurrent:!1},{text:"SUPPORT & FEEDBACK",type:"label",isCurrent:!1},{text:"API Documents",type:"support-link",path:"api-docs/index.html",isCurrent:!1},{text:"Issue Feedback",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new",isCurrent:!1},{text:"Sponsor the Project",type:"support-link",path:"en/sponsor.html",isCurrent:!1}]},"navigation-zh-cn":{home:[{title:"快速开始",link:"zh-cn/quick-start.html",color:"purple",icon:"flash",description:"快速配置 Ktorm 并开始使用"},{title:"SQL DSL",link:"zh-cn/query.html",color:"blue",icon:"code",description:'<a href="/zh-cn/schema-definition.html">定义表结构</a>，使用强类型的灵活的<a href="/zh-cn/query.html">查询 DSL</a>'},{title:"实体序列",link:"zh-cn/entity-sequence.html",color:"green",icon:"line-chart",description:'<a href="/zh-cn/entities-and-column-binding.html">配置列绑定</a>，使用<a href="/zh-cn/entity-sequence.html">序列 API</a> 获取实体对象'},{title:"API 文档",link:"api-docs/index.html",color:"red",icon:"paperclip",description:"查看 Ktorm 中类与函数的 API 文档"}],main:[{text:"概述",type:"link",path:"zh-cn/"},{text:"快速开始",type:"link",path:"zh-cn/quick-start.html"},{text:"连接管理",type:"label"},{text:"连接数据库",type:"link",path:"zh-cn/connect-to-databases.html"},{text:"事务管理",type:"link",path:"zh-cn/transaction-management.html"},{text:"Spring 支持",type:"link",path:"zh-cn/spring-support.html"},{text:"SQL DSL",type:"label"},{text:"定义表结构",type:"link",path:"zh-cn/schema-definition.html"},{text:"查询",type:"link",path:"zh-cn/query.html"},{text:"联表",type:"link",path:"zh-cn/joining.html"},{text:"增删改",type:"link",path:"zh-cn/dml.html"},{text:"运算符",type:"link",path:"zh-cn/operators.html"},{text:"方言与原生 SQL",type:"link",path:"zh-cn/dialects-and-native-sql.html"},{text:"实体类 API",type:"label"},{text:"实体类与列绑定",type:"link",path:"zh-cn/entities-and-column-binding.html"},{text:"实体查询",type:"link",path:"zh-cn/entity-finding.html"},{text:"实体序列",type:"link",path:"zh-cn/entity-sequence.html"},{text:"序列聚合",type:"link",path:"zh-cn/sequence-aggregation.html"},{text:"实体增删改",type:"link",path:"zh-cn/entity-dml.html"},{text:"使用任意的类作为实体类",type:"link",path:"zh-cn/define-entities-as-any-kind-of-classes.html"},{text:"支持和反馈",type:"label"},{text:"API 文档",type:"support-link",path:"api-docs/index.html"},{text:"问题反馈",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new"},{text:"打赏作者",type:"support-link",path:"zh-cn/sponsor.html"}]}},config:{timezone:null,root:"/",time_format:"HH:mm:ss",theme:"doc",algolia:{appId:"2W81KMSLOD",apiKey:"2a146a809de068d9b7a07ba3fb70b4e5",indexName:"ktorm",chunkSize:5e3,fields:["title","lang","date","updated","_content:truncate,0,5200","path","permalink"]}}},window.localStorage&&"true"===window.localStorage.getItem("navigation_collapsed")&&document.getElementsByTagName("body")[0].classList.add("doc-navigation--is-collapsed")</script><div id="navigation-container"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><span class="doc-navbar__logo"><a href="/"><img src="/images/logo.png" class="doc-navbar__logo__img"><img src="/images/logo-middle.png" class="doc-navbar__logo__img-full"></a></span><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i><span class="lang-switcher"><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/schema-definition.html">简体中文</a></span></span></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"><div class="dc-search-form doc-search-form"><input type="search" id="doc-search-input" class="dc-input dc-search-form__input doc-search-form__input" placeholder="Search documents" autofocus><button class="dc-btn dc-search-form__btn doc-search-form__btn" aria-label="Search"><i class="dc-icon dc-icon--search"></i></button></div></div><ul class="doc-sidebar-list"><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/" target="_self"><span>Overview</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/quick-start.html" target="_self"><span>Quick Start</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label"><span>CONNECTION MANAGEMENT</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/connect-to-databases.html" target="_self"><span>Connect to Databases</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/transaction-management.html" target="_self"><span>Transaction Management</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/spring-support.html" target="_self"><span>Spring Support</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label"><span>SQL DSL</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link doc-sidebar-list__item--current"><a href="/en/schema-definition.html" target="_self"><span>Schema Definition</span></a><ul class="doc-sidebar-list__toc-list"></ul></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/query.html" target="_self"><span>Query</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/joining.html" target="_self"><span>Joining</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/dml.html" target="_self"><span>Data Manipulation</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/operators.html" target="_self"><span>Operators</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/dialects-and-native-sql.html" target="_self"><span>Dialects &amp; Native SQL</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label"><span>ENTITY API</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/entities-and-column-binding.html" target="_self"><span>Entities &amp; Column Binding</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/entity-finding.html" target="_self"><span>Entity Query</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/entity-sequence.html" target="_self"><span>Entity Sequence</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/sequence-aggregation.html" target="_self"><span>Sequence Aggregation</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/entity-dml.html" target="_self"><span>Entity Manipulation</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/define-entities-as-any-kind-of-classes.html" target="_self"><span>Define Entities as Any Class</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--label"><span>SUPPORT &amp; FEEDBACK</span></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/api-docs/index.html" target="_self"><span>API Documents</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="https://github.com/kotlin-orm/ktorm/issues/new" target="_self"><span>Issue Feedback</span></a></li><li class="doc-sidebar-list__item doc-sidebar-list__item--link"><a href="/en/sponsor.html" target="_self"><span>Sponsor the Project</span></a></li></ul></div></nav></div></div><div class="doc-content"><div id="lang-switcher-container" class="lang-switcher-container"><span class="lang-switcher" data-reactroot=""><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/schema-definition.html">简体中文</a></span></span></div><div class="dc-page"><div class="dc-card"><div id="doc-search-results" class="doc-search-results"><div id="doc-search-stats"></div><div id="doc-search-hits"></div><div id="doc-search-pagination"></div></div><article id="page-content" class="doc-formatting"><a class="page-link-to-github" target="_blank" href="https://github.com/kotlin-orm/ktorm-docs/edit/master/source/en/schema-definition.md"><i class="icon fa fa-github"></i> <span class="text">Edit Page</span></a><h1 id="Schema-Definition"><a href="#Schema-Definition" class="headerlink" title="Schema Definition"></a>Schema Definition</h1><p>To use SQL DSL, we need to let Ktorm know our schemas. Assuming we have two tables, <code>t_department</code> and <code>t_employee</code>, their schemas are given in the SQL below, how should we descript these two tables with Ktorm?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_department(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  location <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_employee(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  job <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  manager_id <span class="built_in">int</span> <span class="literal">null</span>,</span><br><span class="line">  hire_date <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  salary <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  department_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="Table-Objects"><a href="#Table-Objects" class="headerlink" title="Table Objects"></a>Table Objects</h2><p>Generally, we can define Kotlin objects extending <code>Table</code> to descript our table schemas in Ktorm. The following code defines the two tables with Ktorm:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Departments : Table&lt;<span class="built_in">Nothing</span>&gt;(<span class="string">"t_department"</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> id = int(<span class="string">"id"</span>).primaryKey()</span><br><span class="line">    <span class="keyword">val</span> name = varchar(<span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">val</span> location = varchar(<span class="string">"location"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Employees : Table&lt;<span class="built_in">Nothing</span>&gt;(<span class="string">"t_employee"</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> id = int(<span class="string">"id"</span>).primaryKey()</span><br><span class="line">    <span class="keyword">val</span> name = varchar(<span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">val</span> job = varchar(<span class="string">"job"</span>)</span><br><span class="line">    <span class="keyword">val</span> managerId = int(<span class="string">"manager_id"</span>)</span><br><span class="line">    <span class="keyword">val</span> hireDate = date(<span class="string">"hire_date"</span>)</span><br><span class="line">    <span class="keyword">val</span> salary = long(<span class="string">"salary"</span>)</span><br><span class="line">    <span class="keyword">val</span> departmentId = int(<span class="string">"department_id"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We can see that both <code>Departments</code> and <code>Employees</code> are extending from <code>Table</code> whose constructor accepts a table name as the parameter. There is also a generic type parameter for <code>Table</code> class, that is the entity class’s type that current table is binding to. Here we don’t bind to any entity classes, so <code>Nothing</code> is OK.</p><p>Columns are defined as properties in table objects by Kotlin’s <em>val</em> keyword, their types are defined by type definition functions, such as int, long, varchar, date, etc. Commonly, these type definition functions follow the rules below:</p><ul><li>They are all <code>Table</code> class’s extension functions that are only allowed to be used in table object definitions.</li><li>Their names are corresponding to the underlying SQL types’ names.</li><li>They all accept a parameter of string type, that is the column’s name.</li><li>Their return types are <code>Column&lt;C&gt;</code>, in which C is the type of current column. We can chaining call the extension function <code>primaryKey</code> to declare the current column as a primary key.</li></ul><p>In general, we define tables as Kotlin singleton objects, but we don’t really have to stop there. For instance, assuming that we have two tables that are totally the same, they have the same columns, but their names are different. In this special case, do we have to copy the same column definitions to each table? No, we don’t. We can reuse our codes by subclassing:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Employees</span></span>(tableName: String) : Table&lt;<span class="built_in">Nothing</span>&gt;(tableName) &#123;</span><br><span class="line">    <span class="keyword">val</span> id = int(<span class="string">"id"</span>).primaryKey()</span><br><span class="line">    <span class="keyword">val</span> name = varchar(<span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">val</span> job = varchar(<span class="string">"job"</span>)</span><br><span class="line">    <span class="keyword">val</span> managerId = int(<span class="string">"manager_id"</span>)</span><br><span class="line">    <span class="keyword">val</span> hireDate = date(<span class="string">"hire_date"</span>)</span><br><span class="line">    <span class="keyword">val</span> salary = long(<span class="string">"salary"</span>)</span><br><span class="line">    <span class="keyword">val</span> departmentId = int(<span class="string">"department_id"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> RegularEmployees : Employees(<span class="string">"t_regular_employee"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> FormerEmployees : Employees(<span class="string">"t_former_employee"</span>)</span><br></pre></td></tr></table></figure><p>For another example, sometimes our table is one-off, we don’t need to use it twice, so it’s not necessary to define it as a global object, for fear that the naming space is polluted. This time, we can even define the table as an anonymous object inside a function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> t = <span class="keyword">object</span> : Table&lt;<span class="built_in">Nothing</span>&gt;(<span class="string">"t_config"</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> key = varchar(<span class="string">"key"</span>).primaryKey()</span><br><span class="line">    <span class="keyword">val</span> value = varchar(<span class="string">"value"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get all configs as a Map&lt;String, String&gt;</span></span><br><span class="line"><span class="keyword">val</span> configs = database.from(t).select().associate &#123; row -&gt; row[t.key] to row[t.value] &#125;</span><br></pre></td></tr></table></figure><p>Flexible usage of Kotlin’s language features is helpful for us to reduce duplicated code and improve the maintainability of our projects.</p><h2 id="SqlType"><a href="#SqlType" class="headerlink" title="SqlType"></a>SqlType</h2><p><code>SqlType</code> is an abstract class which provides a unified abstraction for data types in SQL. Based on JDBC, it encapsulates the common operations of obtaining data from a <code>ResultSet</code> and setting parameters to a <code>PreparedStatement</code>. In the section above, we defined columns by column definition functions, eg. int, varchar, etc. All these functions have a <code>SqlType</code> implementation behind them. For example, here is the implementation of <code>int</code> function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> BaseTable<span class="type">&lt;*&gt;</span>.<span class="title">int</span><span class="params">(name: <span class="type">String</span>)</span></span>: Column&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> registerColumn(name, IntSqlType)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> IntSqlType : SqlType&lt;<span class="built_in">Int</span>&gt;(Types.INTEGER, typeName = <span class="string">"int"</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doSetParameter</span><span class="params">(ps: <span class="type">PreparedStatement</span>, index: <span class="type">Int</span>, parameter: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        ps.setInt(index, parameter)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doGetResult</span><span class="params">(rs: <span class="type">ResultSet</span>, index: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> rs.getInt(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>IntSqlType</code> is simple, it just obtaining int query results via <code>ResultSet.getInt</code> and setting parameters via <code>PreparedStatement.setInt</code>.</p><p>Here is a list of SQL types supported in Ktorm by default:</p><table><thead><tr><th>Function Name</th><th>Kotlin Type</th><th>Underlying SQL Type</th><th>JDBC Type Code (java.sql.Types)</th></tr></thead><tbody><tr><td>boolean</td><td>kotlin.Boolean</td><td>boolean</td><td>Types.BOOLEAN</td></tr><tr><td>int</td><td>kotlin.Int</td><td>int</td><td>Types.INTEGER</td></tr><tr><td>short</td><td>kotlin.Short</td><td>smallint</td><td>Types.SMALLINT</td></tr><tr><td>long</td><td>kotlin.Long</td><td>bigint</td><td>Types.BIGINT</td></tr><tr><td>float</td><td>kotlin.Float</td><td>float</td><td>Types.FLOAT</td></tr><tr><td>double</td><td>kotlin.Double</td><td>double</td><td>Types.DOUBLE</td></tr><tr><td>decimal</td><td>java.math.BigDecimal</td><td>decimal</td><td>Types.DECIMAL</td></tr><tr><td>varchar</td><td>kotlin.String</td><td>varchar</td><td>Types.VARCHAR</td></tr><tr><td>text</td><td>kotlin.String</td><td>text</td><td>Types.LONGVARCHAR</td></tr><tr><td>blob</td><td>kotlin.ByteArray</td><td>blob</td><td>Types.BLOB</td></tr><tr><td>bytes</td><td>kotlin.ByteArray</td><td>bytes</td><td>Types.BINARY</td></tr><tr><td>jdbcTimestamp</td><td>java.sql.Timestamp</td><td>timestamp</td><td>Types.TIMESTAMP</td></tr><tr><td>jdbcDate</td><td>java.sql.Date</td><td>date</td><td>Types.DATE</td></tr><tr><td>jdbcTime</td><td>java.sql.Time</td><td>time</td><td>Types.TIME</td></tr><tr><td>timestamp</td><td>java.time.Instant</td><td>timestamp</td><td>Types.TIMESTAMP</td></tr><tr><td>datetime</td><td>java.time.LocalDateTime</td><td>datetime</td><td>Types.TIMESTAMP</td></tr><tr><td>date</td><td>java.time.LocalDate</td><td>date</td><td>Types.DATE</td></tr><tr><td>time</td><td>java.time.Time</td><td>time</td><td>Types.TIME</td></tr><tr><td>monthDay</td><td>java.time.MonthDay</td><td>varchar</td><td>Types.VARCHAR</td></tr><tr><td>yearMonth</td><td>java.time.YearMonth</td><td>varchar</td><td>Types.VARCHAR</td></tr><tr><td>year</td><td>java.time.Year</td><td>int</td><td>Types.INTEGER</td></tr><tr><td>enum</td><td>kotlin.Enum</td><td>enum</td><td>Types.VARCHAR</td></tr><tr><td>uuid</td><td>java.util.UUID</td><td>uuid</td><td>Types.OTHER</td></tr></tbody></table><h2 id="Extend-More-Data-Types"><a href="#Extend-More-Data-Types" class="headerlink" title="Extend More Data Types"></a>Extend More Data Types</h2><p>Sometimes, Ktorm’s built-in data types may not satisfy your requirements. For example, you may want to save a JSON column to a table, many relational databases have supported JSON data type, but raw JDBC haven’t yet, nor Ktorm doesn’t support it by default. However, you can do it by yourself:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonSqlType</span>&lt;<span class="type">T : Any</span>&gt;</span>(</span><br><span class="line">    <span class="keyword">val</span> objectMapper: ObjectMapper,</span><br><span class="line">    <span class="keyword">val</span> javaType: JavaType</span><br><span class="line">) : SqlType&lt;T&gt;(Types.VARCHAR, <span class="string">"json"</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doSetParameter</span><span class="params">(ps: <span class="type">PreparedStatement</span>, index: <span class="type">Int</span>, parameter: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">        ps.setString(index, objectMapper.writeValueAsString(parameter))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doGetResult</span><span class="params">(rs: <span class="type">ResultSet</span>, index: <span class="type">Int</span>)</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">val</span> json = rs.getString(index)</span><br><span class="line">        <span class="keyword">if</span> (json.isNullOrBlank()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objectMapper.readValue(json, javaType)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The class above is a subclass of <code>SqlType</code>, it provides JSON data type support via the Jackson framework. Now we have <code>JsonSqlType</code>, how can we use it to define a column? Looking back the <code>int</code> function’s implementation above, we notice that there is a <code>registerColumn</code> function called. This function is exactly the entry point provided by Ktorm to support datatype extensions. We can also write an extension function like this:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> C : Any&gt;</span> BaseTable<span class="type">&lt;*&gt;</span>.<span class="title">json</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    mapper: <span class="type">ObjectMapper</span> = sharedObjectMapper</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: Column&lt;C&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> registerColumn(name, JsonSqlType(mapper, mapper.constructType(typeOf&lt;C&gt;())))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The usage is as follows:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Foo : Table&lt;<span class="built_in">Nothing</span>&gt;(<span class="string">"foo"</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> bar = json&lt;List&lt;<span class="built_in">Int</span>&gt;&gt;(<span class="string">"bar"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this way, Ktorm is able to read and write JSON columns now. Actually, this is one of the features of the ktorm-jackson module, if you really need to use JSON columns, you don’t have to repeat the code above, please add its dependency to your project:</p><p>Maven：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ktorm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ktorm-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ktorm.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Or Gradle：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">"org.ktorm:ktorm-jackson:$&#123;ktorm.version&#125;"</span></span><br></pre></td></tr></table></figure><p>Additionally, Ktorm 2.7 provides a <code>transform</code> function. With this function, we can extend data types based on existing ones by adding some specific transformations to them. In this way, we get new data types without writing <code>SqlType</code> implementations manually.</p><p>For example, in the following code, we define a column of type <code>Column&lt;UserRole&gt;</code>, but the underlying SQL type in the database is still <code>int</code>. We just perform some transformations while obtaining column values or setting parameters into prepared statements.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> role = int(<span class="string">"role"</span>).transform(&#123; UserRole.fromCode(it) &#125;, &#123; it.code &#125;)</span><br></pre></td></tr></table></figure><p>Please note such transformations will perform on every access to a column, that means you should avoid heavy transformations here.</p><div id="support-footer-container"><div class="doc-support-footer" data-reactroot=""><div class="doc-footer-link">Prev Article: <a href="/en/spring-support.html">Spring Support</a></div><div class="doc-footer-link">Next Article: <a href="/en/query.html">Query</a></div>Any questions about the document? Try searching again on the left menu or <a href="https://github.com/kotlin-orm/ktorm/issues/new" target="_blank" rel="noopener">Raise an issue on Github</a></div></div></article></div></div><div class="doc-footer">&copy; 2021 KTORM.ORG. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache 2.0</a><br>Hosted by <a href="https://github.com/kotlin-orm/ktorm" target="_blank" rel="noopener">GitHub</a> <a href="https://github.com/kotlin-orm/ktorm/stargazers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/stars/kotlin-orm/ktorm.svg?style=social" alt="Stars"></a></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script><script src="/script/doc.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script type="text/javascript">docsearch({appId:"0DGANM0MZ3",apiKey:"071ea85fb6b0933d3f3d3925aa434e23",indexName:"ktorm",inputSelector:"#doc-search-input",algoliaOptions:{facetFilters:["lang:en","tags:doc"]},autocompleteOptions:{hint:!1,appendTo:"body"},debug:!1})</script><script>!function(){$(".kotlin .code .keyword").each(function(){var e=$(this);("where"===e.text()||"set"===e.text())&&e.removeClass("keyword")})}()</script></body></html><!-- rebuild by neat -->