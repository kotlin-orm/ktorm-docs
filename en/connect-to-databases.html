<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Ktorm | Connect to Databases</title><meta name="keywords" content="Kotlin, ORM, SQL, DSL, sequence"><meta name="description" content=""><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="referrer" content="always"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet"><link href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="/vendors/docsearch@2.6.3/docsearch.min.css" rel="stylesheet"><link href="/style/doc.css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180275463-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript">window.__INITIAL_STATE__={page:{title:"Connect to Databases",lang:"en",related_path:"zh-cn/connect-to-databases.html",path:"en/connect-to-databases.html"},data:{"navigation-en":{home:[{title:"Quick Start",link:"en/quick-start.html",color:"purple",icon:"flash",description:"Setting up Ktorm and starting up."},{title:"SQL DSL",link:"en/query.html",color:"blue",icon:"code",description:'Use the strong-typed and flexible <a href="/en/query.html">query DSL</a> after <a href="/en/schema-definition.html">defining table schemas</a>.'},{title:"Entity Sequence",link:"en/entity-sequence.html",color:"green",icon:"line-chart",description:'Obtain entities via <a href="/en/entity-sequence.html">sequence APIs</a> after <a href="/en/entities-and-column-binding.html">column bindings</a> configured.'},{title:"API Documents",link:"api-docs/index.html",target:"_blank",color:"red",icon:"paperclip",description:"API documents for Ktorm's classes and functions."}],main:[{text:"GETTING STARTED",type:"label"},{text:"Overview",type:"link",path:"/"},{text:"Quick Start",type:"link",path:"en/quick-start.html"},{text:"CONNECTION MANAGEMENT",type:"label"},{text:"Connect to Databases",type:"link",path:"en/connect-to-databases.html"},{text:"Transaction Management",type:"link",path:"en/transaction-management.html"},{text:"Spring Support",type:"link",path:"en/spring-support.html"},{text:"SQL DSL",type:"label"},{text:"Schema Definition",type:"link",path:"en/schema-definition.html"},{text:"Query",type:"link",path:"en/query.html"},{text:"Joining",type:"link",path:"en/joining.html"},{text:"Data Manipulation",type:"link",path:"en/dml.html"},{text:"Operators",type:"link",path:"en/operators.html"},{text:"Dialects & Native SQL",type:"link",path:"en/dialects-and-native-sql.html"},{text:"ENTITY API",type:"label"},{text:"Entities & Column Binding",type:"link",path:"en/entities-and-column-binding.html"},{text:"Entity Query",type:"link",path:"en/entity-finding.html"},{text:"Entity Sequence",type:"link",path:"en/entity-sequence.html"},{text:"Sequence Aggregation",type:"link",path:"en/sequence-aggregation.html"},{text:"Entity Manipulation",type:"link",path:"en/entity-dml.html"},{text:"Define Entities as Any Class",type:"link",path:"en/define-entities-as-any-kind-of-classes.html"},{text:"SUPPORT & FEEDBACK",type:"label"},{text:"API Documents",type:"support-link",path:"api-docs/index.html",target:"_blank"},{text:"Issue Feedback",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new",target:"_blank"},{text:"Sponsor the Project",type:"support-link",path:"en/sponsor.html"}]},"navigation-zh-cn":{home:[{title:"快速上手",link:"zh-cn/quick-start.html",color:"purple",icon:"flash",description:"快速配置 Ktorm 并开始使用"},{title:"SQL DSL",link:"zh-cn/query.html",color:"blue",icon:"code",description:'<a href="/zh-cn/schema-definition.html">定义表结构</a>，使用强类型的灵活的<a href="/zh-cn/query.html">查询 DSL</a>'},{title:"实体序列",link:"zh-cn/entity-sequence.html",color:"green",icon:"line-chart",description:'<a href="/zh-cn/entities-and-column-binding.html">配置列绑定</a>，使用<a href="/zh-cn/entity-sequence.html">序列 API</a> 获取实体对象'},{title:"API 文档",link:"api-docs/index.html",target:"_blank",color:"red",icon:"paperclip",description:"查看 Ktorm 中类与函数的 API 文档"}],main:[{text:"开始",type:"label"},{text:"简介",type:"link",path:"zh-cn/"},{text:"快速上手",type:"link",path:"zh-cn/quick-start.html"},{text:"连接管理",type:"label"},{text:"连接数据库",type:"link",path:"zh-cn/connect-to-databases.html"},{text:"事务管理",type:"link",path:"zh-cn/transaction-management.html"},{text:"Spring 支持",type:"link",path:"zh-cn/spring-support.html"},{text:"SQL DSL",type:"label"},{text:"定义表结构",type:"link",path:"zh-cn/schema-definition.html"},{text:"查询",type:"link",path:"zh-cn/query.html"},{text:"联表",type:"link",path:"zh-cn/joining.html"},{text:"增删改",type:"link",path:"zh-cn/dml.html"},{text:"运算符",type:"link",path:"zh-cn/operators.html"},{text:"方言与原生 SQL",type:"link",path:"zh-cn/dialects-and-native-sql.html"},{text:"实体类 API",type:"label"},{text:"实体类与列绑定",type:"link",path:"zh-cn/entities-and-column-binding.html"},{text:"实体查询",type:"link",path:"zh-cn/entity-finding.html"},{text:"实体序列",type:"link",path:"zh-cn/entity-sequence.html"},{text:"序列聚合",type:"link",path:"zh-cn/sequence-aggregation.html"},{text:"实体增删改",type:"link",path:"zh-cn/entity-dml.html"},{text:"使用任意的类作为实体类",type:"link",path:"zh-cn/define-entities-as-any-kind-of-classes.html"},{text:"支持和反馈",type:"label"},{text:"API 文档",type:"support-link",path:"api-docs/index.html",target:"_blank"},{text:"问题反馈",type:"support-link",path:"https://github.com/kotlin-orm/ktorm/issues/new",target:"_blank"},{text:"打赏作者",type:"support-link",path:"zh-cn/sponsor.html"}]}},config:{timezone:null,root:"/",time_format:"HH:mm:ss",theme:"doc"}},window.localStorage&&"true"===window.localStorage.getItem("navigation_collapsed")&&document.getElementsByTagName("body")[0].classList.add("doc-navigation--is-collapsed")</script><div id="navigation-container"><div class="doc-navigation"><nav class="doc-navbar"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i><span class="doc-navbar__logo"><a href="/"><img src="/images/logo.png" class="doc-navbar__logo__img"><img src="/images/logo-middle.png" class="doc-navbar__logo__img-full"></a></span><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close"></i><span class="lang-switcher"><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/connect-to-databases.html">简体中文</a></span></span></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"><div class="dc-search-form doc-search-form"><input type="search" id="doc-search-input" class="dc-input dc-search-form__input doc-search-form__input" placeholder="Search documents" autofocus><button class="dc-btn dc-search-form__btn doc-search-form__btn" aria-label="Search"><i class="dc-icon dc-icon--search"></i></button></div></div><ul class="doc-sidebar-list"></ul></div></nav></div></div><div class="doc-content"><div id="lang-switcher-container" class="lang-switcher-container"><span class="lang-switcher"><span><img src="/images/us.png"><span>English</span></span><span class="lang-divider"> | </span><span><img src="/images/cn.png"><a href="/zh-cn/connect-to-databases.html">简体中文</a></span></span></div><div class="dc-page"><div class="dc-card"><article id="page-content" class="doc-formatting"><a class="page-link-to-github" target="_blank" href="https://github.com/kotlin-orm/ktorm-docs/edit/master/source/en/connect-to-databases.md"><i class="icon fa fa-github"></i> <span class="text">Edit Page</span></a><h1 id="connect-to-databases"><a class="markdownIt-Anchor" href="#connect-to-databases"></a> Connect to Databases</h1><p>To use Ktorm, you need to connect to your databases first. Ktorm provides a <code>Database</code> class to manage your database connections. The <code>Database</code> class is an abstraction of real databases. To create an instance of it, you can call the <code>connect</code> function on its companion object, providing your connection arguments or an existing <code>DataSource</code> object.</p><h2 id="connect-with-a-url"><a class="markdownIt-Anchor" href="#connect-with-a-url"></a> Connect with a URL</h2><p>The code connecting to a MySQL database with a URL, user name and password:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> database = Database.connect(</span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://localhost:3306/ktorm&quot;</span>, </span><br><span class="line">    driver = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>, </span><br><span class="line">    user = <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    password = <span class="string">&quot;***&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Easy to know what we do in the <code>connect</code> function. Just like any JDBC boilerplate code, Ktorm loads the MySQL database driver by <code>Class.forName</code> method first, then calls <code>DriverManager.getConnection</code> with your arguments to obtain a connection.</p><blockquote><p>Of course, Ktorm doesn’t call <code>DriverManager.getConnection</code> in the beginning. Instead, we obtain connections only when it’s really needed (such as executing a SQL), then close them after they are not useful anymore. Therefore, <code>Database</code> objects created by this way won’t reuse any connections, creating connections frequently can lead to huge performance costs. It’s highly recommended to use connection pools in your production environment.</p></blockquote><h2 id="connect-with-a-pool"><a class="markdownIt-Anchor" href="#connect-with-a-pool"></a> Connect with a Pool</h2><p>Ktorm doesn’t limit you, you can use any connection pool you like, such as DBCP, C3P0 or Druid. The <code>connect</code> function provides an overloaded version which accepts a <code>DataSource</code> parameter, you just need to create a <code>DataSource</code> object and call that function with it:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> dataSource = SingleConnectionDataSource() <span class="comment">// Any DataSource implementation is OK. </span></span><br><span class="line"><span class="keyword">val</span> database = Database.connect(dataSource)</span><br></pre></td></tr></table></figure><p>Now, Ktorm will obtain connections from the <code>DataSource</code> when necessary, then return them to the pool after they are not useful. This avoids the performance costs of frequent connection creation.</p><blockquote><p>Connection pools are applicative and effective in most cases, we highly recommend you manage your connections in this way.</p></blockquote><h2 id="connect-manually"><a class="markdownIt-Anchor" href="#connect-manually"></a> Connect Manually</h2><p>If you want to manage connections’ lifecycle manually by yourself without using any connection pools, how to do that with Ktorm? For example, in some special business cases, there is only one connection needed in our whole App’s lifecycle. The connection is created when the App starts and closed when the process exits. The <code>connect</code> function provides another flexible overloaded version which accepts a parameter of type <code>() -&gt; Connection</code>, a function that returns a <code>Connection</code>. The code below shows how to use it:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a connection when the App starts. </span></span><br><span class="line"><span class="keyword">val</span> conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/ktorm&quot;</span>)</span><br><span class="line"></span><br><span class="line">Runtime.getRuntime().addShutdownHook(</span><br><span class="line">    thread(start = <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// Close the connection when the process exits. </span></span><br><span class="line">        conn.close()</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> database = Database.connect &#123;</span><br><span class="line">    <span class="keyword">object</span> : Connection <span class="keyword">by</span> conn &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">close</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="comment">// Override the close function and do nothing, keep the connection open. </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here, we call the <code>connect</code> function with a closure in which we should generally create a connection. However, the <code>Connection</code> is an interface, this allows us to return a proxy object to Ktorm instead of a real connection. The proxy overrides the <code>close</code> function as a no-op. In this way, Ktorm will always get the same connection object by calling the closure, and the connection is never closed in the whole App’s lifecycle.</p><h2 id="use-multiple-databases"><a class="markdownIt-Anchor" href="#use-multiple-databases"></a> Use Multiple Databases</h2><p>The <code>Database.connect</code> function returns a new-created <code>Database</code> object. We should define a variable to save the returned value so as to use it to perform our database operations later. Sometimes, we also need to use many databases in one App, so it’s needed to create many <code>Database</code> instances and choose one while performing our database specific operations.</p><p>The code below connects to two different databases using <code>Database.connect</code> and shows how to switch between them:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> mysql = Database.connect(<span class="string">&quot;jdbc:mysql://localhost:3306/ktorm&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> h2 = Database.connect(<span class="string">&quot;jdbc:h2:mem:ktorm;DB_CLOSE_DELAY=-1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Obtain employees from MySQL database. </span></span><br><span class="line">mysql.sequenceOf(Employees).toList()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Obtain employees from H2 database.</span></span><br><span class="line">h2.sequenceOf(Employees).toList()</span><br></pre></td></tr></table></figure><h2 id="logging"><a class="markdownIt-Anchor" href="#logging"></a> Logging</h2><p>During the running process, Ktorm outputs some useful internal information to the logs, such as generated SQLs, execution parameters, returned results, etc. If you want to see this information and monitor the running process, you may need to configure the logging output.</p><p>In order not to depend on any third-party logging frameworks, Ktorm adds a simple abstraction layer for logging, in which there are only two core classes:</p><ul><li><code>LogLevel</code>: similar to most of the logging frameworks, it’s an enum class that contains five logging levels: <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>.</li><li><code>Logger</code>: an interface that provides some methods used to output logs.</li></ul><p>Ktorm provides many implementations for the <code>Logger</code> interface:</p><table><thead><tr><th>Class Name</th><th>Description</th></tr></thead><tbody><tr><td>ConsoleLogger</td><td>Output logs to the console</td></tr><tr><td>JdkLoggerAdapter</td><td>Delegate logs to java.util.logging</td></tr><tr><td>Slf4jLoggerAdapter</td><td>Delegate logs to slf4j framework</td></tr><tr><td>CommonsLoggerAdapter</td><td>Delegate logs to Apache commons logging lib</td></tr><tr><td>AndroidLoggerAdapter</td><td>Delegate logs to android.util.Log</td></tr></tbody></table><p>By default, Ktorm auto detects the logging framework we are using from the classpath while creating <code>Database</code> instances, and delegates the logs to it. If you want to output logs using a specific logging framework, you can choose an adapter implementation above and set it to the <code>logger</code> parameter. The code below uses a <code>ConsoleLogger</code>, and print logs whose level is greater or equal <code>INFO</code> to the console.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> database = Database.connect(</span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://localhost:3306/ktorm&quot;</span>, </span><br><span class="line">    driver = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>, </span><br><span class="line">    user = <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    password = <span class="string">&quot;***&quot;</span>,</span><br><span class="line">    logger = ConsoleLogger(threshold = LogLevel.INFO)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Ktorm prints different logs at different levels:</p><ul><li>Generated SQLs and their execution arguments are printed at <code>DEBUG</code> level, so if you want to see the SQLs, you should configure your logging framework to enable the <code>DEBUG</code> level.</li><li>Detailed data of every returned entity object are printed at <code>TRACE</code> level, if you want to see them, you should configure your framework to enable <code>TRACE</code>.</li><li>Besides, start-up messages are printed at <code>INFO</code> level, warnings are printed at <code>WARN</code> level, and exceptions are printed at <code>ERROR</code> level. These levels should be enabled by default.</li></ul><div id="support-footer-container"><div class="doc-support-footer"><div class="doc-footer-link">Prev Article: <a href="/en/quick-start.html">Quick Start</a></div><div class="doc-footer-link">Next Article: <a href="/en/transaction-management.html">Transaction Management</a></div>Any questions about the document? Try searching again on the left menu or <a href="https://github.com/kotlin-orm/ktorm/issues/new">raise an issue on GitHub</a></div></div></article></div></div><div class="doc-footer">&copy; 2024 KTORM.ORG. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a><br>Hosted by <a href="https://github.com/kotlin-orm/ktorm">GitHub</a> <a href="https://github.com/kotlin-orm/ktorm/stargazers"><img src="https://img.shields.io/github/stars/kotlin-orm/ktorm.svg?style=social" alt="Stars"></a></div></div><script src="/vendors/jquery@3.2.1/jquery.min.js"></script><script src="/script/doc.js"></script><script type="text/javascript" src="/vendors/docsearch@2.6.3/docsearch.min.js"></script><script type="text/javascript">docsearch({appId:"0DGANM0MZ3",apiKey:"071ea85fb6b0933d3f3d3925aa434e23",indexName:"ktorm",inputSelector:"#doc-search-input",algoliaOptions:{facetFilters:["lang:en","tags:doc"]},autocompleteOptions:{hint:!1,appendTo:"body"},debug:!1})</script><script>$(".kotlin .code .keyword").each(function(){var e=$(this);"where"!==e.text()&&"set"!==e.text()||e.removeClass("keyword")})</script></body></html>